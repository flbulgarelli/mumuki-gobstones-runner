<link href="./gs-element-blockly.html" rel="import" />
<link href="./gobstones-code-runner.html" rel="import" />

<dom-module id="blockly-container">
  <template>
    <gs-element-blockly id="blocklyElement"></gs-element-blockly>
  </template>

  <script>
    Polymer({
      is: 'blockly-container',
      ready: function() {
        setTimeout(() => {
          var metadata = $("#mu-custom-editor-metadata")[0].value;
          if (metadata) {
            this.$.blocklyElement.workspaceXml = metadata;
          }
          this.$.blocklyElement.workspace.addChangeListener(() => {
            $("#mu-custom-editor-value")[0].value = this.$.blocklyElement.generateCode();
            $("#mu-custom-editor-metadata")[0].value = this.$.blocklyElement.workspaceXml;
          });
        });
      }
    });
  </script>
</dom-module>
